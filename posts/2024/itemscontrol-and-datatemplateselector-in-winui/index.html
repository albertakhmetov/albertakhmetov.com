<!DOCTYPE html>
<html lang="en" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>ItemsControl and DataTemplateSelector in WinUI | Albert Akhmetov</title>
<meta name="keywords" content="WinUI, .NET, DataTemplateSelector, ItemsControl">
<meta name="description" content="Sometimes even simple things can be confusing. Especially if you don&rsquo;t encounter them every day. The funniest thing is if you&rsquo;ve already solved this problem and successfully forgot about it after some time.">
<meta name="author" content="">
<link rel="canonical" href="https://albertakhmetov.com/posts/2024/itemscontrol-and-datatemplateselector-in-winui/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.css" rel="preload stylesheet" as="style">
<link rel="icon" href="https://albertakhmetov.com/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="https://albertakhmetov.com/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="https://albertakhmetov.com/favicon-32x32.png">
<link rel="apple-touch-icon" href="https://albertakhmetov.com/apple-touch-icon.png">
<link rel="mask-icon" href="https://albertakhmetov.com/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<link rel="alternate" hreflang="en" href="https://albertakhmetov.com/posts/2024/itemscontrol-and-datatemplateselector-in-winui/">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --code-block-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript><meta property="og:title" content="ItemsControl and DataTemplateSelector in WinUI" />
<meta property="og:description" content="Sometimes even simple things can be confusing. Especially if you don&rsquo;t encounter them every day. The funniest thing is if you&rsquo;ve already solved this problem and successfully forgot about it after some time." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://albertakhmetov.com/posts/2024/itemscontrol-and-datatemplateselector-in-winui/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2024-11-11T23:00:00+05:00" />
<meta property="article:modified_time" content="2024-11-11T23:00:00+05:00" />

<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="ItemsControl and DataTemplateSelector in WinUI"/>
<meta name="twitter:description" content="Sometimes even simple things can be confusing. Especially if you don&rsquo;t encounter them every day. The funniest thing is if you&rsquo;ve already solved this problem and successfully forgot about it after some time."/>


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "Posts",
      "item": "https://albertakhmetov.com/posts/"
    }, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "ItemsControl and DataTemplateSelector in WinUI",
      "item": "https://albertakhmetov.com/posts/2024/itemscontrol-and-datatemplateselector-in-winui/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "ItemsControl and DataTemplateSelector in WinUI",
  "name": "ItemsControl and DataTemplateSelector in WinUI",
  "description": "Sometimes even simple things can be confusing. Especially if you don\u0026rsquo;t encounter them every day. The funniest thing is if you\u0026rsquo;ve already solved this problem and successfully forgot about it after some time.\n",
  "keywords": [
    "WinUI", ".NET", "DataTemplateSelector", "ItemsControl"
  ],
  "articleBody": "Sometimes even simple things can be confusing. Especially if you don’t encounter them every day. The funniest thing is if you’ve already solved this problem and successfully forgot about it after some time.\nWith this note I want to create a reminder for myself on how to use DataTemplateSelector in ItemsControl properly.\nThe steps to implement the support for DataTemplateSelector:\nImplement the class that inherits DataTemplateSelector Add properties to store data templates Override two Core methods with template selection logic Add data templates to the resources Add the template selector to the resources (and set data templates) Set ItemTemplateSelector property of ItemsControl Suppose, we need to create a template selector to select a template for the menu item: text item or separator. The following code shows the simple data template selector:\nclass MenuItemTemplateSelector : DataTemplateSelector { public DataTemplate ItemTemplate { get; set; } public DataTemplate SeparatorTemplate { get; set; } // This method isn't invoked. As a result, only the result of .ToString() is shown protected override DataTemplate SelectTemplateCore(object item) { if (item is IconMenuItem menuItem) { return menuItem.Text == \"-\" ? SeparatorTemplate : ItemTemplate; } else { return null; } } // So we also need to implement this method. It solves the problem and the template is selected properly protected override DataTemplate SelectTemplateCore(object item, DependencyObject container) { return SelectTemplateCore(item); } } In the documentation only the first method is implemented. But in this case it’s not called (or is called in special cases that I haven’t found). So we need to implement the second method to make the template selection work.\nOtherwise, everything works as described in the documentation.\nAnd the XAML file is the following:\n",
  "wordCount" : "318",
  "inLanguage": "en",
  "datePublished": "2024-11-11T23:00:00+05:00",
  "dateModified": "2024-11-11T23:00:00+05:00",
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://albertakhmetov.com/posts/2024/itemscontrol-and-datatemplateselector-in-winui/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "Albert Akhmetov",
    "logo": {
      "@type": "ImageObject",
      "url": "https://albertakhmetov.com/favicon.ico"
    }
  }
}
</script>
</head>

<body class="" id="top">
<script>
    if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="https://albertakhmetov.com/" accesskey="h" title="Albert Akhmetov (Alt + H)">Albert Akhmetov</a>
            <div class="logo-switches">
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="https://albertakhmetov.com/posts/introduce" title="about me">
                    <span>about me</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    
    <h1 class="post-title entry-hint-parent">
      ItemsControl and DataTemplateSelector in WinUI
    </h1>
    <div class="post-meta"><span title='2024-11-11 23:00:00 +0500 +05'>November 11, 2024</span>

</div>
  </header> 
  <div class="post-content"><p>Sometimes even simple things can be confusing. Especially if you don&rsquo;t encounter them every day. The funniest thing is if you&rsquo;ve already solved this problem and successfully forgot about it after some time.</p>
<p>With this note I want to create a reminder for myself on how to use <code>DataTemplateSelector</code> in <code>ItemsControl</code> properly.</p>
<p>The steps to implement the support for <code>DataTemplateSelector</code>:</p>
<ul>
<li>Implement the class that inherits <code>DataTemplateSelector</code>
<ul>
<li>Add properties to store data templates</li>
<li>Override <strong>two</strong> Core methods with template selection logic</li>
</ul>
</li>
<li>Add data templates to the resources</li>
<li>Add the template selector to the resources (and set data templates)</li>
<li>Set <code>ItemTemplateSelector</code> property of <code>ItemsControl</code></li>
</ul>
<p>Suppose, we need to create a template selector to select a template for the menu item: text item or separator. The following code shows the simple data template selector:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-C#" data-lang="C#"><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">MenuItemTemplateSelector</span> : DataTemplateSelector
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> DataTemplate ItemTemplate { <span style="color:#66d9ef">get</span>; <span style="color:#66d9ef">set</span>; }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> DataTemplate SeparatorTemplate { <span style="color:#66d9ef">get</span>; <span style="color:#66d9ef">set</span>; }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// This method isn&#39;t invoked. As a result, only the result of .ToString() is shown</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">protected</span> <span style="color:#66d9ef">override</span> DataTemplate SelectTemplateCore(<span style="color:#66d9ef">object</span> item)
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> (item <span style="color:#66d9ef">is</span> IconMenuItem menuItem)
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> menuItem.Text == <span style="color:#e6db74">&#34;-&#34;</span>
</span></span><span style="display:flex;"><span>                ? SeparatorTemplate
</span></span><span style="display:flex;"><span>                : ItemTemplate;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">else</span>
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">null</span>;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// So we also need to implement this method. It solves the problem and the template is selected properly</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">protected</span> <span style="color:#66d9ef">override</span> DataTemplate SelectTemplateCore(<span style="color:#66d9ef">object</span> item, DependencyObject container)
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> SelectTemplateCore(item);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>In the <a href="https://learn.microsoft.com/en-us/windows/apps/design/controls/data-template-selector">documentation</a> only the first method is implemented. But in this case it&rsquo;s not called (or is called in special cases that I haven&rsquo;t found). So we need to implement the second method to make the template selection work.</p>
<p>Otherwise, everything works as described in the documentation.</p>
<p>And the XAML file is the following:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-XML" data-lang="XML"><span style="display:flex;"><span><span style="color:#f92672">&lt;Grid.Resources&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&lt;DataTemplate</span> <span style="color:#a6e22e">x:DataType=</span><span style="color:#e6db74">&#34;root:IconMenuItem&#34;</span> <span style="color:#a6e22e">x:Key=</span><span style="color:#e6db74">&#34;SeparatorTemplate&#34;</span><span style="color:#f92672">&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&lt;MenuFlyoutSeparator</span> <span style="color:#a6e22e">IsTabStop=</span><span style="color:#e6db74">&#34;False&#34;</span> <span style="color:#f92672">/&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&lt;/DataTemplate&gt;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&lt;DataTemplate</span> <span style="color:#a6e22e">x:DataType=</span><span style="color:#e6db74">&#34;root:IconMenuItem&#34;</span> <span style="color:#a6e22e">x:Key=</span><span style="color:#e6db74">&#34;ItemTemplate&#34;</span><span style="color:#f92672">&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&lt;MenuFlyoutItem</span>
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">Padding=</span><span style="color:#e6db74">&#34;12, 6&#34;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">Text=</span><span style="color:#e6db74">&#34;{Binding Text, Mode=OneWay}&#34;</span> 
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">Command=</span><span style="color:#e6db74">&#34;{Binding Command, Mode=OneWay}&#34;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">Click=</span><span style="color:#e6db74">&#34;MenuFlyoutItem_Click&#34;</span> <span style="color:#f92672">/&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&lt;/DataTemplate&gt;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&lt;local:MenuItemTemplateSelector</span> <span style="color:#a6e22e">x:Key=</span><span style="color:#e6db74">&#34;TemplateSelector&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">ItemTemplate=</span><span style="color:#e6db74">&#34;{StaticResource ItemTemplate}&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">SeparatorTemplate=</span><span style="color:#e6db74">&#34;{StaticResource SeparatorTemplate}&#34;</span> <span style="color:#f92672">/&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">&lt;/Grid.Resources&gt;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">&lt;ItemsControl</span> <span style="color:#a6e22e">Background=</span><span style="color:#e6db74">&#34;Transparent&#34;</span> <span style="color:#a6e22e">Padding=</span><span style="color:#e6db74">&#34;5&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">ItemsSource=</span><span style="color:#e6db74">&#34;{Binding MenuItems, Mode=OneWay}&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">ItemTemplateSelector=</span><span style="color:#e6db74">&#34;{StaticResource TemplateSelector}&#34;</span><span style="color:#f92672">&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">&lt;/ItemsControl&gt;</span>
</span></span></code></pre></div>

  </div>

  <footer class="post-footer">
    <ul class="post-tags">
      <li><a href="https://albertakhmetov.com/tags/winui/">WinUI</a></li>
      <li><a href="https://albertakhmetov.com/tags/.net/">.NET</a></li>
      <li><a href="https://albertakhmetov.com/tags/datatemplateselector/">DataTemplateSelector</a></li>
      <li><a href="https://albertakhmetov.com/tags/itemscontrol/">ItemsControl</a></li>
    </ul>
  </footer>
</article>
    </main>
    
<footer class="footer">
        <span>&copy; 2024 <a href="https://albertakhmetov.com/">Albert Akhmetov</a></span> · 

    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;

        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerHTML = 'copy';

        function copyingDone() {
            copybutton.innerHTML = 'copied!';
            setTimeout(() => {
                copybutton.innerHTML = 'copy';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                navigator.clipboard.writeText(codeblock.textContent);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) { };
            selection.removeRange(range);
        });

        if (container.classList.contains("highlight")) {
            container.appendChild(copybutton);
        } else if (container.parentNode.firstChild == container) {
            
        } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
            
            codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
        } else {
            
            codeblock.parentNode.appendChild(copybutton);
        }
    });
</script>
</body>

</html>
