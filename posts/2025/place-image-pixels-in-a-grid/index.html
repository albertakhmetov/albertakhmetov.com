<!DOCTYPE html>
<html lang="en" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>Place image pixels in a grid | Albert Akhmetov</title>
<meta name="keywords" content="How use Direct2D in WinUI 3, Hardware accelerated graphics WinUI, Place image pixels in a grid">
<meta name="description" content="Let&rsquo;s draw a pixelated image separated by transparent lines in Win2D!">
<meta name="author" content="">
<link rel="canonical" href="https://albertakhmetov.com/posts/2025/place-image-pixels-in-a-grid/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.css" rel="preload stylesheet" as="style">
<link rel="icon" href="https://albertakhmetov.com/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="https://albertakhmetov.com/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="https://albertakhmetov.com/favicon-32x32.png">
<link rel="apple-touch-icon" href="https://albertakhmetov.com/apple-touch-icon.png">
<link rel="mask-icon" href="https://albertakhmetov.com/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<link rel="alternate" hreflang="en" href="https://albertakhmetov.com/posts/2025/place-image-pixels-in-a-grid/">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --code-block-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript><meta property="og:title" content="Place image pixels in a grid" />
<meta property="og:description" content="Let&rsquo;s draw a pixelated image separated by transparent lines in Win2D!" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://albertakhmetov.com/posts/2025/place-image-pixels-in-a-grid/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2025-01-19T12:00:00+05:00" />
<meta property="article:modified_time" content="2025-01-19T12:00:00+05:00" />

<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Place image pixels in a grid"/>
<meta name="twitter:description" content="Let&rsquo;s draw a pixelated image separated by transparent lines in Win2D!"/>


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "Posts",
      "item": "https://albertakhmetov.com/posts/"
    }, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "Place image pixels in a grid",
      "item": "https://albertakhmetov.com/posts/2025/place-image-pixels-in-a-grid/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "Place image pixels in a grid",
  "name": "Place image pixels in a grid",
  "description": "Let\u0026rsquo;s draw a pixelated image separated by transparent lines in Win2D!\n",
  "keywords": [
    "How use Direct2D in WinUI 3", "Hardware accelerated graphics WinUI", "Place image pixels in a grid"
  ],
  "articleBody": "Let’s draw a pixelated image separated by transparent lines in Win2D!\nThe problem: display a pixelated image with transparent lines between pixels. Like this:\nI learned about Win2D completely by accident. I was looking for how to fix blurry image stretching in WinUI. Win2D can draw images with “nearest neighbor” interpolation. So I decided to use Win2D in my small project.\nWhen we scale a small image (for example, icons) at the full window size the image is very pixelated. Separating pixels with lines helps to improve the situation a little bit (see the image above).\nWe can draw an image and then draw lines on it. But this approach doesn’t support transparency.\nAnother approach is to use an image brush and fill a group of rectangles with spaces between them (one rectangle per pixel).\nThe brush fills a rectangle with the part of the image that corresponds to the rectangle. The trick is to scale and translate the brush to the target rectangle:\nimageBrush.Transform = Matrix3x2.CreateTranslation(Convert.ToSingle(left / ScaleFactor), Convert.ToSingle(top / ScaleFactor)) * Matrix3x2.CreateScale(Convert.ToSingle(ScaleFactor)); left and top - coordinates of the rectangle; ScaleFactor - how many times the image is scaled.\nEvery pixel-rectangle (square) has size equal to integer part of a number scale factor without the separator line width. I found out that the scale factor must be greater than 5 and line width is 2px. So pixel-rectangle has size 3px and more.\nThe following code generates pixel-rectangles:\nvoid ImageCanvas_Draw(CanvasControl sender, CanvasDrawEventArgs args) { var width = ImageSize.Width * ScaleFactor; var height = ImageSize.Height * ScaleFactor; var left = (sender.ActualWidth - width) / 2; var top = (sender.ActualHeight - height) / 2; imageBrush.Transform = Matrix3x2.CreateTranslation(Convert.ToSingle(left / ScaleFactor), Convert.ToSingle(top / ScaleFactor)) * Matrix3x2.CreateScale(Convert.ToSingle(ScaleFactor)); var pixelSize = Convert.ToSingle(scaleFactor); const int LINE_WIDTH = 2; for (var i = 0; i \u003c ImageSize.Width; i++) { for (var j = 0; j \u003c ImageSize.Height; j++) { args.DrawingSession.FillRectangle( rect: new Rect( x: left + i * pixelSize, y: top + j * pixelSize, width: pixelSize - LINE_WIDTH, height: pixelSize - LINE_WIDTH), brush: imageBrush); } } } Useful links:\nLoading resources outside of CreateResources (Documentation)\nWin2D: DirectX-Powered Drawing in C# (YouTube)\n",
  "wordCount" : "355",
  "inLanguage": "en",
  "datePublished": "2025-01-19T12:00:00+05:00",
  "dateModified": "2025-01-19T12:00:00+05:00",
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://albertakhmetov.com/posts/2025/place-image-pixels-in-a-grid/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "Albert Akhmetov",
    "logo": {
      "@type": "ImageObject",
      "url": "https://albertakhmetov.com/favicon.ico"
    }
  }
}
</script>
</head>

<body class="" id="top">
<script>
    if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="https://albertakhmetov.com/" accesskey="h" title="Albert Akhmetov (Alt + H)">Albert Akhmetov</a>
            <div class="logo-switches">
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="https://albertakhmetov.com/posts/introduce" title="about me">
                    <span>about me</span>
                </a>
            </li>
            <li>
                <a href="https://albertakhmetov.com/tags" title="tags">
                    <span>tags</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    
    <h1 class="post-title entry-hint-parent">
      Place image pixels in a grid
    </h1>
    <div class="post-meta"><span title='2025-01-19 12:00:00 +0500 +05'>January 19, 2025</span>

</div>
  </header> 
  <div class="post-content"><p>Let&rsquo;s draw a pixelated image separated by transparent lines in Win2D!</p>
<p>The problem: display a pixelated image with <em>transparent</em> lines between pixels. Like this:</p>
<p><img loading="lazy" src="image.png" alt="image"  />
</p>
<p>I learned about Win2D completely by accident. I was looking for how to fix blurry image stretching in WinUI. Win2D can draw images with &ldquo;nearest neighbor&rdquo; interpolation. So I decided to use Win2D in my small project.</p>
<p>When we scale a small image (for example, icons) at the full window size the image is very pixelated. Separating pixels with lines helps to improve the situation a little bit (see the image above).</p>
<p>We can draw an image and then draw lines on it. But this approach doesn&rsquo;t support transparency.</p>
<p>Another approach is to use an image brush and fill a group of rectangles with spaces between them (one rectangle per pixel).</p>
<p>The brush fills a rectangle with the part of the image that corresponds to the rectangle. The trick is to scale and translate the brush to the target rectangle:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-C#" data-lang="C#"><span style="display:flex;"><span>imageBrush.Transform =
</span></span><span style="display:flex;"><span>    Matrix3x2.CreateTranslation(Convert.ToSingle(left / ScaleFactor), Convert.ToSingle(top / ScaleFactor)) *
</span></span><span style="display:flex;"><span>    Matrix3x2.CreateScale(Convert.ToSingle(ScaleFactor));
</span></span></code></pre></div><p><code>left</code> and <code>top</code> - coordinates of the rectangle; <code>ScaleFactor</code> - how many times the image is scaled.</p>
<p>Every pixel-rectangle (square) has size equal to integer part of a number scale factor without the separator line width. I found out that the scale factor must be greater than 5 and line width is 2px. So pixel-rectangle has size 3px and more.</p>
<p>The following code generates pixel-rectangles:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-C#" data-lang="C#"><span style="display:flex;"><span><span style="color:#66d9ef">void</span> ImageCanvas_Draw(CanvasControl sender, CanvasDrawEventArgs args) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">var</span> width = ImageSize.Width * ScaleFactor;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">var</span> height = ImageSize.Height * ScaleFactor;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">var</span> left = (sender.ActualWidth - width) / <span style="color:#ae81ff">2</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">var</span> top = (sender.ActualHeight - height) / <span style="color:#ae81ff">2</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    imageBrush.Transform =
</span></span><span style="display:flex;"><span>        Matrix3x2.CreateTranslation(Convert.ToSingle(left / ScaleFactor), Convert.ToSingle(top / ScaleFactor)) *
</span></span><span style="display:flex;"><span>        Matrix3x2.CreateScale(Convert.ToSingle(ScaleFactor));
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">var</span> pixelSize = Convert.ToSingle(scaleFactor);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">const</span> <span style="color:#66d9ef">int</span> LINE_WIDTH = <span style="color:#ae81ff">2</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">var</span> i = <span style="color:#ae81ff">0</span>; i &lt; ImageSize.Width; i++)
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">var</span> j = <span style="color:#ae81ff">0</span>; j &lt; ImageSize.Height; j++)
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            args.DrawingSession.FillRectangle(
</span></span><span style="display:flex;"><span>                rect: <span style="color:#66d9ef">new</span> Rect(
</span></span><span style="display:flex;"><span>                    x: left + i * pixelSize,
</span></span><span style="display:flex;"><span>                    y: top + j * pixelSize,
</span></span><span style="display:flex;"><span>                    width: pixelSize - LINE_WIDTH,
</span></span><span style="display:flex;"><span>                    height: pixelSize - LINE_WIDTH),
</span></span><span style="display:flex;"><span>                brush: imageBrush);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>Useful links:</p>
<ul>
<li>
<p><a href="https://microsoft.github.io/Win2D/WinUI3/html/LoadingResourcesOutsideCreateResources.htm">Loading resources outside of CreateResources</a> (Documentation)</p>
</li>
<li>
<p><a href="https://www.youtube.com/watch?v=-9o52zDVZS4">Win2D: DirectX-Powered Drawing in C#</a> (YouTube)</p>
</li>
</ul>

  </div>

  <footer class="post-footer">
    <ul class="post-tags">
      <li><a href="https://albertakhmetov.com/tags/c%23/">C#</a></li>
      <li><a href="https://albertakhmetov.com/tags/.net/">.NET</a></li>
      <li><a href="https://albertakhmetov.com/tags/win2d/">Win2D</a></li>
    </ul>
  </footer>
</article>
    </main>
    
<footer class="footer">
        <span>&copy; 2025 <a href="https://albertakhmetov.com/">Albert Akhmetov</a></span> · 

    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;

        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerHTML = 'copy';

        function copyingDone() {
            copybutton.innerHTML = 'copied!';
            setTimeout(() => {
                copybutton.innerHTML = 'copy';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                navigator.clipboard.writeText(codeblock.textContent);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) { };
            selection.removeRange(range);
        });

        if (container.classList.contains("highlight")) {
            container.appendChild(copybutton);
        } else if (container.parentNode.firstChild == container) {
            
        } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
            
            codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
        } else {
            
            codeblock.parentNode.appendChild(copybutton);
        }
    });
</script>
</body>

</html>
